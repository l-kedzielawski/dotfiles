###### GENERAL ####################################################

# Disable tmux mouse by default (terminal owns the mouse)
set -g mouse off

# Bigger scrollback
set -g history-limit 10000

# Faster Esc (good for Vim/Neovim)
set -s escape-time 0

# Focus events for apps that use them
set -g focus-events on

# Renumber windows when one is closed
set -g renumber-windows on

# Set terminal window titles
set -g set-titles on

# vi-style keys in status line and copy-mode
set -g status-keys vi
setw -g mode-keys vi

# Better colors for Neovim/fzf/etc.
set -g default-terminal "tmux-256color"
set -as terminal-features '*:RGB'

# Optional: start windows/panes at 1
# set -g base-index 1
# setw -g pane-base-index 1


###### PREFIX / RELOAD ############################################

# Prefix stays Ctrl-b
# Reload config: Prefix + r
bind r source-file ~/.tmux.conf \; display "Reloaded tmux.conf"


###### MOUSE TOGGLE (simple version) ################################

unbind m
unbind M

bind M set -g mouse on  \; display-message "Mouse: ON"
bind m set -g mouse off \; display-message "Mouse: OFF"


###### PANE / WINDOW MANAGEMENT ####################################

# Splits
bind | split-window -h         # Prefix + |
bind - split-window -v         # Prefix + -
bind % split-window -h         # Prefix + %
bind '"' split-window -v       # Prefix + "

# Move between panes (vim-style)
bind h select-pane -L          # Prefix + h
bind j select-pane -D          # Prefix + j
bind k select-pane -U          # Prefix + k
bind l select-pane -R          # Prefix + l

# Resize panes
bind H resize-pane -L 5        # Prefix + H
bind J resize-pane -D 2        # Prefix + J
bind K resize-pane -U 2        # Prefix + K
bind L resize-pane -R 5        # Prefix + L


###### CLIPBOARD (via ~/.local/bin/tmux-copy) #####################

# Advertise clipboard support (helps OSC52-capable terminals)
set -s set-clipboard on

# In copy-mode-vi:
# - v   starts selection
# - V   selects whole line
# - C-v toggles rectangle selection
unbind -T copy-mode-vi v
bind   -T copy-mode-vi v  send-keys -X begin-selection

unbind -T copy-mode-vi V
bind   -T copy-mode-vi V  send-keys -X select-line

unbind -T copy-mode-vi C-v
bind   -T copy-mode-vi C-v send-keys -X rectangle-toggle

# y -> copy selection via tmux-copy and exit copy-mode
unbind -T copy-mode-vi y
bind   -T copy-mode-vi y \
  send-keys -X copy-pipe-and-cancel "~/.local/bin/tmux-copy"

# Y -> copy from cursor to end of pane
unbind -T copy-mode-vi Y
bind   -T copy-mode-vi Y \
  send-keys -X copy-pipe-and-cancel "tmux capture-pane -pS - | ~/.local/bin/tmux-copy"

# Enter / Ctrl-c also copy selection
unbind -T copy-mode-vi Enter
bind   -T copy-mode-vi Enter \
  send-keys -X copy-pipe-and-cancel "~/.local/bin/tmux-copy"

unbind -T copy-mode-vi C-c
bind   -T copy-mode-vi C-c \
  send-keys -X copy-pipe-and-cancel "~/.local/bin/tmux-copy"

# Mouse drag in copy-mode (both vi & emacs tables) auto-copies
unbind -T copy-mode-vi MouseDragEnd1Pane
bind   -T copy-mode-vi MouseDragEnd1Pane \
  send-keys -X copy-pipe-and-cancel "~/.local/bin/tmux-copy"

unbind -T copy-mode MouseDragEnd1Pane
bind   -T copy-mode MouseDragEnd1Pane \
  send-keys -X copy-pipe-and-cancel "~/.local/bin/tmux-copy"

# IMPORTANT:
# No root MouseDown/MouseDrag bindings here on purpose.
# That keeps Neovim + tmux mouse behavior sane.


###### STATUS BAR (minimal) ########################################

set -g status on
set -g status-interval 5

set -g status-left-length 40
set -g status-right-length 120

set -g status-style fg=colour250,bg=colour236

# Left: session name
set -g status-left  "#[bold]#S #[fg=colour240]|"

# Right: date time | user@host
set -g status-right "#[fg=colour240]%Y-%m-%d %H:%M #[fg=colour240]| #[fg=colour244]#(whoami)@#H"


###### QUALITY OF LIFE ############################################

# Faster pane switching while holding prefix
bind -r C-h select-pane -L
bind -r C-j select-pane -D
bind -r C-k select-pane -U
bind -r C-l select-pane -R

# Toggle broadcast input to all panes in this window
# Prefix + S
bind S setw synchronize-panes \; display "Sync panes: #{?pane_synchronized,ON,OFF}"

# New window in the current pane's directory
unbind c
bind c new-window -c "#{pane_current_path}"

# New window in the current pane's directory
unbind c
bind c new-window -c "#{pane_current_path}"

# Splits inherit current pane's directory
unbind |
bind | split-window -h -c "#{pane_current_path}"

unbind -
bind - split-window -v -c "#{pane_current_path}"

unbind %
bind % split-window -h -c "#{pane_current_path}"

unbind '"'
bind '"' split-window -v -c "#{pane_current_path}"

